<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<link rel="stylesheet" type="text/css" href="exolve-m.css?v0.20"/>
<script src="exolve-m.js?v0.20"></script>

<!--
MIT License

Copyright (c) 2019 Viresh Ratnakar

See the full license notice in exolve-m.js.

Version: Exolve v0.20 September 2 2019
-->

<title>Al’s Trick</title>

<script>

const puzzleText = `
======REPLACE WITH YOUR PUZZLE BELOW======
exolve-begin
  exolve-id: gussalufz-15
  exolve-title: Al’s Trick
  exolve-setter: Gussalufz
  exolve-copyright: 2019 Viresh Ratnakar
  exolve-width: 15
  exolve-height: 15
  exolve-grid:
    0 0 0|0 0 0 0 . 0 0 0 0|0 0 0
    0 . 0|0 . 0 . . . 0 . 0|0 . 0
    0_0_0+0 0 0 0 . 0 0 0 0|0 0 0
    0 . 0|0 . 0 . 0 . 0 . 0|0_._0_
    0 0 0|0 0 0 0 0 0 0 0 0|0 0 0
    0 . 0|. . 0 . 0 . . 0 .|0 . 0
    0 0_0+0 0 0 0 . 0 0 0 0|0 0 0
    0 . 0|0 . 0 . . . 0 . 0|0_._0
    0 0 0|0 0 0 0 . 0 0 0 0|0 0 0
    0 . 0|. 0 . . 0 . 0 . .|0 . 0
    0_0_0+0 0 0 0 0 0 0 0 0|0 0 0
    0 . 0|0 . 0 . 0 . 0 . 0|0_._0_
    0 0 0|0 0 0 0 . 0 0 0 0|0 0 0
    0 . 0|0 . 0 . . . 0 . 0|0 . 0
    0 0 0|0 0 0 0 . 0 0 0 0|0 0 0
  exolve-prelude:
    <p>
    In eight clues, the definition parts have been replaced by the words
    “Al’s Trick.” Once you’ve figured out Al’s Trick, you can replace each
    “Al’s Trick” in these eight clues with one of the words revealed in
    the puzzle by applying Al’s Trick.
    </p>
    <p>
    Here’s a clue that reveals what Al’s Trick is:
    <blockquote>
    If held upside-down, sneaking old man finally reveals Al’s Trick (4-2)
    </blockquote>
    Once you enter the right solution to this clue in the designated space
    under the grid, you will even be able to see Al’s Trick in action!
    </p>
    <p>
    Al’s Trick has been a regular feature in X Y for over 55 years.
    Discerning solvers can also find the words X and Y in this puzzle.
    </p>

  exolve-question: If held upside-down, sneaking old man finally reveals Al’s Trick (4-2)
  exolve-question: Al’s Trick has been a regular feature in what? (Two Words)
  exolve-question: What are the eight “Al’s Trick” words, <i>in the order of the clues in which they are used as definitions</i> (viz, 3a, 11a, 12a, 43a, 48a, 3d, 23d, 38d)? (65)*

  exolve-across:
    1 Main sources of slanderous election ads (3)
    3 Al returns, this time for Al’s Trick (4)
    5 Dude with ultimate goatee and long hair (4)
    8 Wife, perhaps has new child (3)
    10 A bird heading west as well (3)
    11 Visiting Uruguay to show Al’s Trick (4)
    12 Al’s Trick bewildered many, with RxN (4)
    13 A low-wattage lamp showed the way (3)
    17 Me?? In camp of this article of impeachment, badly! (3)
    18 Angry woman’s target: man at fault (9)
    20 Speed, for starters, is relative (3)
    22 Soup found in top hotels? (3)
    23 Do not start to lecture; keep away! (4)
    24 Over a sequence of sixteen letters… (4)
    27 …to leading novelists in this century (3)
    29 My love for a car (3)
    30 Unit told to crawl (4)
    32 An island country, new and lacking passion (4)
    33 “Disgusting liquid!” (soup returned without any love) (3)
    35 Segment of people, generally (3)
    36 This is perhaps a-spicin’ a piece of chilli! (9)
    39 One running: “Charge!” (3)
    42 One full of mischief, just not sly (3)
    43 Worldwide audience selection: Al’s Trick! (4)
    44 The guys came back to consume hallucinogenic herb (4)
    45 Perform a cabaret on vacation (3)
    47 Shortlist guys (3)
    48 Young man swallows sword, finally, for Al’s Trick (4)
    49 Saw colour coming back around the middle of cheek (4)
    50 Rock tour drops U2’s leader (3)
  exolve-down:
    1 What I did to create this clue collection? (3)
    2 Back of a length (3)
    3 Al’s Trick: precisely swapping hands (5)
    4 Take free company magazine (9)
    6 This might express the heart’s outpourings (5)
    7 A country of good type corrupted (5)
    8 Second-class material (4)
    9 One’s removed undies off (4)
    14 Unusual, oddly artsy tendency to eat, say, chalk and pencil tip (8)
    15 The rock going around a star (4)
    16 Nearly built nuclear war deterrent (3)
    19 Modern revolution is regularly full of itself (3)
    20 Plot credit announced (4)
    21 Sweet sound of kissing son goodnight (8)
    23 Al’s Trick clue lacks novelty to start with (3)
    25 Betrayal of society, ultimately, by faculty member, after drinking a bit of rum (9)
    26 Almost muted close friend! (3)
    28 Tease after calling beginner’s bluff (4)
    31 Wild at heart date? (3)
    33 Nearly indivisible, to be precise! (4)
    34 Flat price, already discounted to start with! (3)
    36 Scale’s extremely cruel northbound measure of bulk (5)
    37 Provided sexual satisfaction? Not sure? Ask! (5)
    38 Rising call for abbreviated Al’s Trick (5)
    40 Sex before and after interval limits movie (4)
    41 A country avoiding a revolution (4)
    45 Proper tap dancing (3)
    46 Pitch turning at Member’s End (3)
exolve-end
======REPLACE WITH YOUR PUZZLE ABOVE======
`;

function setupChA() {
  const elt = document.getElementsByClassName('answer')[0]
  elt.addEventListener('input', chA);
}

function hashCode(str) {
  return str.split('').reduce((prevHash, currVal) =>
    (((prevHash << 5) - prevHash) + currVal.charCodeAt(0))|0, 0);
}

function chA() {
  const elt = document.getElementsByClassName('answer')[0]
  let eltAltr = document.getElementById('altr')
  if (hashCode(elt.value) == 34710129) {
    if (!eltAltr) {
      eltAltrPar = document.createElement('span');
      eltAltrPar.innerHTML = '&nbsp; <button class="button" style="font-size:10px;padding:4px 8px" onclick="shA()" id="altr">Show Al’s Fold-In Trick!</button>'
      const q = document.getElementsByClassName('question')[0]
      q.appendChild(eltAltrPar)
      eltAltr = document.getElementById('altr')
    }
    eltAltr.style.display = ''
  } else {
    if (eltAltr) {
      eltAltr.style.display = 'none'
    }
  }
}

function doA(movers) {
  let midX = (GRIDLINE + (GRIDLINE + SQUARE_DIM)*15)*0.5
  let delta = 1
  let did = false
  for (let row = 0; row < 15; row++) {
    let cell = movers[row][7].cell
    if (!cell) {
      continue
    }
    let x = Number(cell.getAttribute('x'))
    let w = Number(cell.getAttribute('width'))
    if (w > 1) {
      w = w - 2
      x = x + delta
      cell.setAttributeNS(null, 'width', w)
      cell.setAttributeNS(null, 'x', x)
      did = true
    }
  }
  if (did) {
    for (let row = 0; row < 15; row++) {
      for (let e of movers[row][7].others) {
        let x = Number(e.getAttribute('x'))
        x = x + delta
        e.setAttributeNS(null, 'x', x)
      }
    }
    delta++
  } else {
    for (let row = 0; row < 15; row++) {
      let cell = movers[row][7].cell
      if (cell) {
        cell.style.display = 'none'
      }
      for (let e of movers[row][7].others) {
        e.style.display = 'none'
      }
    }
  }
  let midDelta = delta

  for (let col = 6; col >= 3; col--) {
    did = false
    for (let row = 0; row < 15; row++) {
      let cell = movers[row][col].cell
      if (!cell) {
        continue
      }
      let x = Number(cell.getAttribute('x'))
      let w = Number(cell.getAttribute('width'))
      if (w > 0) {
        w = w - 1
        x = x + delta
        if (x + w > midX) {
          w = midX - x
        }
        cell.setAttributeNS(null, 'width', w)
        cell.setAttributeNS(null, 'x', x)
        did = true
      }
    }
    if (did) {
      for (let row = 0; row < 15; row++) {
        for (let e of movers[row][col].others) {
          let x = Number(e.getAttribute('x'))
          x = x + delta
          e.setAttributeNS(null, 'x', x)
        }
      }
      delta++
    } else {
      for (let row = 0; row < 15; row++) {
        let cell = movers[row][col].cell
        if (cell) {
          cell.style.display = 'none'
        }
        for (let e of movers[row][col].others) {
          e.style.display = 'none'
        }
      }
    }
  }
  delta--
  if (delta <= 0) {
    delta = 1
  }

  for (let col = 2; col >= 0; col--) {
    for (let row = 0; row < 15; row++) {
      let cell = movers[row][col].cell
      if (cell) {
        const x = Number(cell.getAttribute('x')) + delta
        cell.setAttributeNS(null, 'x', x)
      }
      for (let e of movers[row][col].others) {
        const x = Number(e.getAttribute('x')) + delta
        e.setAttributeNS(null, 'x', x)
      }
    }
  }

  delta = midDelta

  for (let col = 8; col <= 11; col++) {
    did = false
    for (let row = 0; row < 15; row++) {
      let cell = movers[row][col].cell
      if (!cell) {
        continue
      }
      let x = Number(cell.getAttribute('x'))
      let w = Number(cell.getAttribute('width'))
      if (w > 0) {
        w = w - 1
        x = x - delta
        if (x < midX) {
          w -= (midX - x)
          if (w < 0) {
  	    w = 0
          }
          x = midX
        }
        cell.setAttributeNS(null, 'width', w)
        cell.setAttributeNS(null, 'x', x)
        did = true
      }
    }
    if (did) {
      for (let row = 0; row < 15; row++) {
        for (let e of movers[row][col].others) {
          let x = Number(e.getAttribute('x'))
          x = x - delta
          e.setAttributeNS(null, 'x', x)
        }
      }
      delta++
    } else {
      for (let row = 0; row < 15; row++) {
        let cell = movers[row][col].cell
        if (cell) {
          cell.style.display = 'none'
        }
        for (let e of movers[row][col].others) {
          e.style.display = 'none'
        }
      }
    }
  }

  for (let col = 12; col < 15; col++) {
    for (let row = 0; row < 15; row++) {
      let cell = movers[row][col].cell
      if (cell) {
        const x = Number(cell.getAttribute('x')) - delta
        cell.setAttributeNS(null, 'x', x)
      }
      for (let e of movers[row][col].others) {
        const x = Number(e.getAttribute('x')) - delta
        e.setAttributeNS(null, 'x', x)
      }
    }
  }
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function obfs(s) {
 o = ''
 m = '42themeaningoflife'
 for (let i = 0; i < s.length; i++) {
   c = s.charCodeAt(i) ^ m.charCodeAt(i % m.length)
   o = o + String.fromCharCode(c)
 }
 return o
}

let aActv = -1

async function shA() {
  if (aActv > 0) {
    aActv += 5
    return
  }
  let alq = document.getElementById('alq')
  if (!alq) {
    alq = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    alq.setAttributeNS(null, 'id', 'alq')

    alq1 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    alq1.setAttributeNS(null, 'x', 340)
    alq1.setAttributeNS(null, 'y', 360)
    alq1.setAttributeNS(null, 'fill', 'white')
    const text1 = document.createTextNode(obfs(decodeURIComponent("%16a%11%1A%0C%02%10%12N%19%0B%08%1F%0A%09")))
    alq1.appendChild(text1);
    alq.appendChild(alq1)

    alq2 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    alq2.setAttributeNS(null, 'x', 340)
    alq2.setAttributeNS(null, 'y', 410)
    alq2.setAttributeNS(null, 'fill', 'white')
    const text2 = document.createTextNode(obfs(decodeURIComponent("YKT%09%02%08E%00%1C%0CN%03%0A%07%08GD")))
    alq2.appendChild(text2);
    alq.appendChild(alq2)

    alq3 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    alq3.setAttributeNS(null, 'x', 340)
    alq3.setAttributeNS(null, 'y', 460)
    alq3.setAttributeNS(null, 'fill', 'white')
    const text3 = document.createTextNode(obfs(decodeURIComponent("%E2%80%A0s%18H%2F%0C%03%07%0B%0CBG%5E_%5EXK")))
    alq3.appendChild(text3);
    alq.appendChild(alq3)

    alq4 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    alq4.setAttributeNS(null, 'x', 40)
    alq4.setAttributeNS(null, 'y', 40)
    alq4.setAttributeNS(null, 'fill', 'white')
    const text4 = document.createTextNode(obfs(decodeURIComponent("%01%07T%11%00%0C%17%12N%06%08")))
    alq4.appendChild(text4);
    alq.appendChild(alq4)

    alq5 = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    alq5.setAttributeNS(null, 'x', 340)
    alq5.setAttributeNS(null, 'y', 40)
    alq5.setAttributeNS(null, 'fill', 'white')
    const text5 = document.createTextNode(obfs(decodeURIComponent("ys0H%23%02%09%05C%20%00%14")))
    alq5.appendChild(text5);
    alq.appendChild(alq5)

    svg.appendChild(alq)
  }
  alq.style.display = ''
  let eltAltr = document.getElementById('altr')
  deactivateCurrentCell()
  eltAltr.disabled = true
  gridInput.style.display = 'none'
  let wasShowingNinas = showingNinas

  const texts = document.getElementsByTagName('text')
  const rects = document.getElementsByTagName('rect')

  let movers = []
  for (let row = 0; row < 15; row++) {
    movers[row] = []
    for (let col = 0; col < 15; col++) {
      movers[row].push({
        'cell': null,
        'cellX': -1,
        'cellW': -1,
        'cellF': '',
        'others': [],
        'othersX': [],
      })
    }
  }
  const elts = []
  for (let i = 0; i < texts.length; i++) {
    elts.push(texts[i])
  }
  for (let i = 0; i < rects.length; i++) {
    elts.push(rects[i])
  }
  let alElts = []

  for (let elt of elts) {
    const x = Number(elt.getAttribute('x'))
    const y = Number(elt.getAttribute('y'))
    const c = elt.getAttribute('class')
    let col = -1
    let row = -1
    if (c == 'cell') {
      col = Math.round((x - GRIDLINE) / (SQUARE_DIM + GRIDLINE))
      row = Math.round((y - GRIDLINE) / (SQUARE_DIM + GRIDLINE))
      movers[row][col].cell = elt
      movers[row][col].cellX = x
      movers[row][col].cellW = Number(elt.getAttribute('width'))
      movers[row][col].cellF = elt.style.fill
      if ((col >= 0 && col <= 2) || (col >= 12 && col <= 14)) {
        if (row >= 0 && row % 2 == 0) {
          alElts.push(elt)
        }
      }
    } else if (c == 'cell-text') {
      col = Math.round((x - LIGHT_START_X) / (SQUARE_DIM + GRIDLINE))
      row = Math.round((y - LIGHT_START_Y) / (SQUARE_DIM + GRIDLINE))
      movers[row][col].others.push(elt)
      movers[row][col].othersX.push(x)
    } else if (c == 'cell-num') {
      col = Math.round((x - NUMBER_START_X) / (SQUARE_DIM + GRIDLINE))
      row = Math.round((y - NUMBER_START_Y) / (SQUARE_DIM + GRIDLINE))
      movers[row][col].others.push(elt)
      movers[row][col].othersX.push(x)
    } else if (c == 'background') {
      const w = Number(elt.getAttribute('width'))
      if (w == BAR_WIDTH) {
        col = Math.round(((x - GRIDLINE + BAR_WIDTH_BY2) / (SQUARE_DIM + GRIDLINE)) - 1)
        if (col == 11) {
          col = 12
        }
        row = Math.round((y - GRIDLINE) / (SQUARE_DIM + GRIDLINE))
        movers[row][col].others.push(elt)
        movers[row][col].othersX.push(x)
      } else if (w == SQUARE_DIM) {
        col = Math.round((x - GRIDLINE) / (SQUARE_DIM + GRIDLINE))
        if (col == 11) {
          col = 12
        }
        row = Math.round(((y - GRIDLINE + BAR_WIDTH_BY2) / (SQUARE_DIM + GRIDLINE)) - 1)
        movers[row][col].others.push(elt)
        movers[row][col].othersX.push(x)
      }
    }
  }

  if (showingNinas) {
    hideNinas()
  }
  let steps = SQUARE_DIM + 2
  for (let s = 0; s < steps; s++) {
    doA(movers)
    await sleep(50)
  }
  for (e of alElts) {
    e.style.fill = 'palegreen'
  }
  aActv = 10
  eltAltr.innerText = '' + aActv + 's, click for more time'
  eltAltr.disabled = false
  while (aActv >= 0) {
    eltAltr.style.background = 'darkgreen'
    await sleep(500)
    eltAltr.style.background = '#4CAF50'
    await sleep(500)
    aActv--
    eltAltr.innerText = (aActv < 10 ? '0' : '') + aActv + 's, click for more time'
  }
  eltAltr.style.background = ''
  eltAltr.innerText = 'Show Al’s Fold-In Trick!'

  alq.style.display = 'none'
  for (let row = 0; row < 15; row++) {
    for (let col = 0; col < 15; col++) {
      if (movers[row][col].cell) {
        movers[row][col].cell.setAttributeNS(null, 'x', movers[row][col].cellX)
        movers[row][col].cell.setAttributeNS(null, 'width', movers[row][col].cellW)
        movers[row][col].cell.style.fill = movers[row][col].cellF
        movers[row][col].cell.style.display = ''
      }
      if (!movers[row][col].others) {
        continue
      }
      for (let i = 0; i < movers[row][col].others.length; i++) {
        let e = movers[row][col].others[i]
        let x = movers[row][col].othersX[i]
        e.setAttributeNS(null, 'x', x)
        e.style.display = ''
      }
    }
  }
  gridInput.style.display = ''
  if (wasShowingNinas) {
    showNinas()
  }
}

</script>

</head>

<body onload="createPuzzle();setupChA();chA()">

<div class="flex-col" id="outermost-stack">
  <h2 id="title">Title</h2>
  <div id="setter"></div>
  <div id="prelude"></div>
  <div id="current-clue-parent">
    <div id="current-clue"></div>
  </div>
  <div class="flex-row">
    <div id="grid-panel">
      <div id="grid-parent-centerer">
        <div id="grid-parent">
          <svg id="grid" zoomAndPan="disable"></svg>
          <div id="grid-input-wrapper" style="display:none;left:0;top:0"><input id="grid-input" type="text" maxlength="2" autocomplete="off" spellcheck="false" class="cell-text"/></div>
          <div id="nina-group" style="display:none;left:0;top:0"></div>
        </div> <!-- #grid-parent -->
      </div> <!-- #grid-parent-centerer -->
      <div id="small-print" class="wide-box">
        <a id="report-bug" href="https://github.com/viresh-ratnakar/exolve/issues/new">Report bug</a>
        <a id="exolve-link" href="https://github.com/viresh-ratnakar/exolve">Exolve on GitHub</a>
        <span id="copyright"></span>
      </div> <!-- #small-print -->
      <div id="controls-etc">
        <div id="controls" class="wide-box">
          <div id="button-row-1" class="controls-row">
            <button id="clear" class="button"
                onclick="clearCurrent()">Clear this</button>
            <button id="clear-all" class="button"
                onclick="clearAll()">Clear all!</button>
            <button id="check" class="button" style="display:none"
                onclick="checkCurrent()">Check this</button>
            <button id="check-all" class="button" style="display:none"
                onclick="checkAll()">Check all!</button>
          </div> <!-- #button-row-1 -->
          <div id="button-row-2" class="controls-row">
            <button id="reveal" class="button" style="display:none"
                onclick="revealCurrent()">Reveal this</button>
            <button id="ninas" class="button" style="display:none"
                onclick="toggleNinas()">Show ninas</button>
            <button id="reveal-all" class="button" style="display:none"
                onclick="revealAll()">Reveal all!</button>
          </div> <!-- #button-row-2 -->
        </div> <!-- #controls -->
        <div id="errors"></div>
        <div id="status">
          Squares filled:
          <span id="status-num-filled">0</span>/<span
                id="status-num-total"></span>
        </div> <!-- #status -->
        <div id="saving" class="wide-box">
          Your entries are saved automatically in a cookie, for the most
          recent puzzle that you open from this site. Bookmark/save the
          <a id="saving-url" href="">URL</a> for more reliable recovery.
        </div> <!-- #saving -->
        <div id="questions" class="wide-box"></div> 
        <div id="submit-parent">
          <button id="submit" class="button" style="display:none"
              onclick="submitSolution()">Submit!</button>
        </div> <!-- submit-parent -->
        <div id="explanations" class="wide-box" style="display:none"></div>
      </div> <!-- #controls-etc -->
      <br/>
      <br/>
    </div> <!-- #grid-panel -->
    <div id="clues" class="flex-row">
      <div id="across-clues-panel" class="clues-box" style="display:none">
        <hr/>
        <b>Across</b>
        <table id="across"></table>
        <br/>
      </div> <!-- #across-clues-panel -->
      <div id="down-clues-panel" class="clues-box" style="display:none">
        <hr/>
        <b>Down</b>
        <table id="down"></table>
        <br/>
      </div> <!-- #down-clues-panel -->
      <div id="nodir-clues-panel" class="clues-box" style="display:none">
        <hr/>
        <table id="nodir"></table>
        <br/>
      </div> <!-- #nodir-clues-panel -->
    </div> <!-- #clues -->
  </div>
</div> <!-- #outermost-stack -->

</body>

</html>
